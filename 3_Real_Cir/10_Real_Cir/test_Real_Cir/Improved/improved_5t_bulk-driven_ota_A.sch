v {xschem version=3.4.6 file_version=1.2
* Copyright 2023 IHP PDK Authors
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     https://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.

}
G {}
K {}
V {}
S {}
E {}
T {Vx
} 2230 -660 0 0 0.4 0.4 {}
T {Vx
} 1690 -660 0 0 0.4 0.4 {}
T {Vip
} 1640 -590 0 0 0.4 0.4 {}
T {Vin
} 2300 -590 0 0 0.4 0.4 {}
T {Vip
} 1130 -770 0 0 0.4 0.4 {}
T {Vin
} 1130 -700 0 0 0.4 0.4 {}
N 920 -290 920 -270 {
lab=GND}
N 1000 -290 1000 -270 {
lab=GND}
N 1120 -370 1240 -370 {
lab=GND}
N 1180 -470 1200 -470 {lab=#net1}
N 1180 -570 1180 -470 {lab=#net1}
N 1180 -640 1240 -640 {lab=#net1}
N 1180 -570 1200 -570 {lab=#net1}
N 1180 -640 1180 -570 {lab=#net1}
N 1240 -470 1300 -470 {lab=GND}
N 1300 -470 1300 -370 {lab=GND}
N 1240 -440 1240 -370 {lab=GND}
N 1240 -570 1300 -570 {lab=GND}
N 1300 -570 1300 -470 {lab=GND}
N 1240 -540 1240 -500 {lab=#net2}
N 920 -900 920 -350 {lab=v_dd}
N 1480 -830 1540 -830 {lab=v_dd}
N 1540 -900 1540 -860 {lab=v_dd}
N 1580 -830 1620 -830 {lab=#net3}
N 1620 -830 1620 -780 {lab=#net3}
N 1540 -780 1620 -780 {lab=#net3}
N 1540 -800 1540 -780 {lab=#net3}
N 1540 -640 1540 -600 {lab=#net3}
N 1480 -470 1500 -470 {lab=#net3}
N 1480 -570 1480 -470 {lab=#net3}
N 1480 -640 1540 -640 {lab=#net3}
N 1480 -570 1500 -570 {lab=#net3}
N 1480 -640 1480 -570 {lab=#net3}
N 1540 -470 1600 -470 {lab=GND}
N 1600 -470 1600 -370 {lab=GND}
N 1540 -440 1540 -370 {lab=GND}
N 1540 -570 1600 -570 {lab=GND}
N 1600 -570 1600 -470 {lab=GND}
N 1540 -520 1540 -500 {lab=#net4}
N 1540 -780 1540 -640 {lab=#net3}
N 1460 -470 1480 -470 {lab=#net3}
N 1360 -470 1420 -470 {lab=GND}
N 1360 -470 1360 -370 {lab=GND}
N 1420 -440 1420 -370 {lab=GND}
N 1660 -830 1720 -830 {lab=#net3}
N 1760 -830 1820 -830 {lab=v_dd}
N 1760 -900 1760 -860 {lab=v_dd}
N 1760 -780 1760 -760 {lab=#net5}
N 1420 -370 1540 -370 {lab=GND}
N 1700 -730 1760 -730 {lab=v_dd}
N 1700 -900 1760 -900 {lab=v_dd}
N 1480 -900 1540 -900 {lab=v_dd}
N 1760 -630 1820 -630 {lab=GND}
N 1820 -630 1820 -370 {lab=GND}
N 1760 -370 1820 -370 {lab=GND}
N 1760 -600 1760 -370 {lab=GND}
N 1760 -680 1760 -660 {lab=#net3}
N 2180 -900 2180 -860 {lab=v_dd}
N 2130 -830 2180 -830 {lab=v_dd}
N 2130 -900 2130 -830 {lab=v_dd}
N 1540 -370 1600 -370 {lab=GND}
N 1480 -900 1480 -830 {lab=v_dd}
N 1820 -900 1820 -830 {lab=v_dd}
N 1760 -900 1820 -900 {lab=v_dd}
N 1240 -370 1300 -370 {lab=GND}
N 1360 -370 1420 -370 {lab=GND}
N 1300 -370 1360 -370 {lab=GND}
N 2180 -780 2180 -760 {lab=#net6}
N 2220 -830 2310 -830 {lab=v_dd}
N 2310 -900 2310 -830 {lab=v_dd}
N 2240 -900 2310 -900 {lab=v_dd}
N 2370 -900 2370 -860 {lab=v_dd}
N 2310 -900 2370 -900 {lab=v_dd}
N 2310 -830 2330 -830 {lab=v_dd}
N 2370 -830 2430 -830 {lab=v_dd}
N 2430 -900 2430 -830 {lab=v_dd}
N 2370 -900 2430 -900 {lab=v_dd}
N 2180 -700 2180 -660 {lab=#net7}
N 2220 -630 2250 -630 {lab=#net1}
N 2130 -630 2180 -630 {lab=GND}
N 2130 -630 2130 -370 {lab=GND}
N 2030 -370 2130 -370 {lab=GND}
N 2130 -900 2180 -900 {lab=v_dd}
N 2080 -900 2130 -900 {lab=v_dd}
N 1910 -680 1910 -590 {lab=#net6}
N 1910 -680 2060 -780 {lab=#net6}
N 2060 -780 2180 -780 {lab=#net6}
N 2180 -800 2180 -780 {lab=#net6}
N 1950 -560 1960 -560 {lab=#net8}
N 1960 -730 1960 -560 {lab=#net8}
N 1800 -730 1960 -730 {lab=#net8}
N 1990 -560 2000 -560 {lab=#net9}
N 1760 -780 1900 -780 {lab=#net5}
N 1760 -800 1760 -780 {lab=#net5}
N 1910 -530 1910 -520 {lab=#net4}
N 1540 -520 1910 -520 {lab=#net4}
N 1540 -540 1540 -520 {lab=#net4}
N 1700 -560 1910 -560 {lab=v_in}
N 1660 -680 1760 -680 {lab=#net3}
N 1760 -700 1760 -680 {lab=#net3}
N 1660 -830 1660 -680 {lab=#net3}
N 1620 -830 1660 -830 {lab=#net3}
N 2040 -680 2040 -590 {lab=#net5}
N 1900 -780 2040 -680 {lab=#net5}
N 2160 -560 2340 -560 {lab=v_out}
N 2180 -600 2180 -370 {lab=GND}
N 1990 -730 1990 -560 {lab=#net9}
N 1990 -730 2140 -730 {lab=#net9}
N 1980 -440 1990 -440 {lab=GND}
N 1980 -440 1980 -370 {lab=GND}
N 1970 -440 1980 -440 {lab=GND}
N 1930 -370 1980 -370 {lab=GND}
N 2030 -410 2030 -370 {lab=GND}
N 1980 -370 2030 -370 {lab=GND}
N 1930 -410 1930 -370 {lab=GND}
N 1820 -370 1930 -370 {lab=GND}
N 1860 -440 1930 -440 {lab=v_dd}
N 1860 -900 1860 -440 {lab=v_dd}
N 1820 -900 1860 -900 {lab=v_dd}
N 2030 -440 2080 -440 {lab=v_dd}
N 2080 -900 2080 -440 {lab=v_dd}
N 1860 -900 2080 -900 {lab=v_dd}
N 1960 -560 1960 -500 {lab=#net8}
N 1930 -500 1960 -500 {lab=#net8}
N 1930 -500 1930 -470 {lab=#net8}
N 2030 -500 2030 -470 {lab=#net9}
N 1990 -500 2030 -500 {lab=#net9}
N 1990 -560 1990 -500 {lab=#net9}
N 1840 -500 1930 -500 {lab=#net8}
N 1840 -500 1840 -420 {lab=#net8}
N 1700 -420 1840 -420 {lab=#net8}
N 1700 -440 1700 -420 {lab=#net8}
N 1700 -560 1700 -500 {lab=v_in}
N 2160 -560 2160 -500 {lab=v_out}
N 2040 -560 2160 -560 {lab=v_out}
N 2030 -500 2120 -500 {lab=#net9}
N 2120 -500 2120 -420 {lab=#net9}
N 2120 -420 2160 -420 {lab=#net9}
N 2160 -440 2160 -420 {lab=#net9}
N 2040 -530 2040 -520 {lab=#net10}
N 2040 -520 2260 -520 {lab=#net10}
N 2260 -450 2370 -450 {lab=#net10}
N 2300 -500 2370 -500 {lab=GND}
N 2300 -410 2300 -370 {lab=GND}
N 2130 -370 2180 -370 {lab=GND}
N 2370 -380 2370 -370 {lab=GND}
N 2300 -370 2370 -370 {lab=GND}
N 2300 -410 2370 -410 {lab=GND}
N 2300 -500 2300 -410 {lab=GND}
N 2260 -520 2260 -450 {lab=#net10}
N 2370 -450 2370 -440 {lab=#net10}
N 2370 -560 2370 -530 {lab=#net11}
N 2370 -470 2370 -450 {lab=#net10}
N 2410 -410 2460 -410 {lab=#net11}
N 2460 -500 2460 -410 {lab=#net11}
N 2410 -500 2460 -500 {lab=#net11}
N 2460 -560 2460 -500 {lab=#net11}
N 2370 -560 2460 -560 {lab=#net11}
N 2370 -800 2370 -560 {lab=#net11}
N 920 -1040 920 -900 {lab=v_dd}
N 1360 -1040 1420 -1040 {lab=v_dd}
N 1420 -1040 1420 -1020 {lab=v_dd}
N 1360 -990 1420 -990 {lab=v_dd}
N 1360 -1040 1360 -990 {lab=v_dd}
N 920 -1040 1360 -1040 {lab=v_dd}
N 1420 -940 1420 -500 {lab=#net12}
N 1420 -940 1480 -940 {lab=#net12}
N 1420 -960 1420 -940 {lab=#net12}
N 1480 -990 1480 -940 {lab=#net12}
N 1460 -990 1480 -990 {lab=#net12}
N 1480 -990 2500 -990 {lab=#net12}
N 2540 -990 2600 -990 {lab=v_dd}
N 2600 -1040 2600 -990 {lab=v_dd}
N 2540 -1040 2540 -1020 {lab=v_dd}
N 2540 -1040 2600 -1040 {lab=v_dd}
N 1420 -1040 2540 -1040 {lab=v_dd}
N 2540 -380 2540 -370 {lab=GND}
N 2540 -410 2600 -410 {lab=GND}
N 2600 -410 2600 -370 {lab=GND}
N 2540 -370 2600 -370 {lab=GND}
N 2370 -370 2540 -370 {lab=GND}
N 2540 -720 2540 -440 {lab=#net13}
N 2480 -410 2500 -410 {lab=#net11}
N 2480 -460 2480 -410 {lab=#net11}
N 2460 -410 2480 -410 {lab=#net11}
N 2480 -460 2660 -460 {lab=#net11}
N 2660 -460 2660 -410 {lab=#net11}
N 2660 -410 2720 -410 {lab=#net11}
N 2760 -410 2820 -410 {lab=GND}
N 2820 -410 2820 -370 {lab=GND}
N 2760 -370 2820 -370 {lab=GND}
N 2760 -380 2760 -370 {lab=GND}
N 2760 -720 2760 -440 {lab=v_out}
N 2760 -1040 2760 -1020 {lab=v_dd}
N 2600 -1040 2760 -1040 {lab=v_dd}
N 2640 -990 2640 -720 {lab=#net13}
N 2540 -720 2640 -720 {lab=#net13}
N 2540 -960 2540 -720 {lab=#net13}
N 2640 -990 2720 -990 {lab=#net13}
N 2600 -370 2760 -370 {lab=GND}
N 2640 -720 2680 -720 {lab=#net13}
N 2740 -720 2760 -720 {lab=v_out}
N 2760 -960 2760 -720 {lab=v_out}
N 2780 -720 2860 -720 {lab=v_out}
N 2860 -720 2860 -700 {lab=v_out}
N 2860 -640 2860 -620 {lab=GND}
N 2860 -720 2940 -720 {lab=v_out}
N 1630 -560 1700 -560 {lab=v_in}
N 1630 -740 1630 -560 {lab=v_in}
N 1240 -900 1480 -900 {lab=v_dd}
N 1240 -620 1240 -600 {lab=#net1}
N 1240 -800 1240 -640 {lab=#net1}
N 2340 -600 2340 -560 {lab=v_out}
N 1120 -670 2340 -670 {lab=v_out}
N 1240 -900 1240 -860 {lab=v_dd}
N 920 -900 1240 -900 {lab=v_dd}
N 2760 -990 2820 -990 {lab=v_dd}
N 2820 -1040 2820 -990 {lab=v_dd}
N 2760 -1040 2820 -1040 {lab=v_dd}
N 1700 -630 1720 -630 {lab=#net1}
N 1580 -630 1580 -620 {lab=#net1}
N 1240 -620 1580 -620 {lab=#net1}
N 1240 -640 1240 -620 {lab=#net1}
N 2250 -630 2250 -580 {lab=#net1}
N 2110 -580 2250 -580 {lab=#net1}
N 2110 -600 2110 -580 {lab=#net1}
N 1840 -600 2110 -600 {lab=#net1}
N 1840 -600 1840 -580 {lab=#net1}
N 1700 -580 1840 -580 {lab=#net1}
N 1700 -630 1700 -580 {lab=#net1}
N 1580 -630 1700 -630 {lab=#net1}
N 1120 -400 1120 -370 {lab=GND}
N 1000 -740 1000 -480 {lab=v_in}
N 1000 -740 1630 -740 {lab=v_in}
N 1000 -370 1000 -350 {lab=v_ss}
N 1000 -420 1000 -400 {lab=GND}
N 1000 -400 1120 -400 {lab=GND}
N 1120 -670 1120 -480 {lab=v_out}
N 2780 -720 2780 -600 {lab=v_out}
N 2760 -720 2780 -720 {lab=v_out}
N 2340 -600 2780 -600 {lab=v_out}
N 2340 -670 2340 -600 {lab=v_out}
N 2180 -370 2300 -370 {lab=GND}
N 1600 -370 1760 -370 {lab=GND}
N 2240 -900 2240 -730 {lab=v_dd}
N 2180 -900 2240 -900 {lab=v_dd}
N 2180 -730 2240 -730 {lab=v_dd}
N 1700 -900 1700 -730 {lab=v_dd}
N 1540 -900 1700 -900 {lab=v_dd}
C {devices/title.sym} 160 -30 0 0 {name=l5 author="Copyright 2024 IHP PDK Authors"}
C {devices/code_shown.sym} 20 -950 0 0 {name=NGSPICE only_toplevel=true 
value="
.temp 27
.control
option sparse
save all

*tran 10n 10u
*write eaa_improved_5t_bulk-driven_ota.raw
*plot v(v_inp) v(v_inn) v(v_out)

.title Bulk Driven OTA

op
write ota-improved_tb-ac.raw
set appendwrite

ac dec 101 1k 1G
write eaa_improved_5t_bulk-driven_ota.raw
plot 20*log10(v_out)

meas ac dcgain MAX vmag(v_out) FROM=10 TO=10k
let f3db = dcgain/sqrt(2)
meas ac fbw WHEN vmag(v_out)=f3db FALL=1
let gainerror=(dcgain-1)/1
print dcgain
print fbw
print gainerror

noise v(v_out) Vin dec 101 1k 100MEG 1000
print onoise_total

.endc
"}
C {devices/vsource.sym} 920 -320 0 0 {name=Vdd value=1.5}
C {devices/gnd.sym} 920 -270 0 0 {name=l3 lab=GND}
C {devices/launcher.sym} 550 -150 0 0 {name=h2
descr="simulate" 
tclcommand="xschem save; xschem netlist; xschem simulate"
}
C {devices/launcher.sym} 790 -150 0 0 {name=h3
descr="annotate OP" 
tclcommand="set show_hidden_texts 1; xschem annotate_op"
}
C {lab_pin.sym} 920 -370 0 0 {name=p3 sig_type=std_logic lab=v_dd}
C {devices/vsource.sym} 1000 -320 0 0 {name=Vss value=0}
C {devices/gnd.sym} 1000 -270 0 0 {name=l1 lab=GND}
C {lab_pin.sym} 1000 -370 0 0 {name=p7 sig_type=std_logic lab=v_ss}
C {lab_wire.sym} 1120 -740 0 0 {name=p9 sig_type=std_logic lab=v_in
}
C {devices/code_shown.sym} 20 -270 0 0 {name=MODEL only_toplevel=true
format="tcleval( @value )"
value=".lib $::SG13G2_MODELS/cornerMOSlv.lib mos_tt
.lib $::SG13G2_MODELS/cornerCAP.lib cap_typ
.lib $::SG13G2_MODELS/cornerRES.lib res_typ
.inc $::PDK_ROOT/ihp-sg13g2/libs.ref/sg13g2_stdcell/spice/sg13g2_stdcell.spice
"}
C {sg13g2_pr/sg13_lv_pmos.sym} 2520 -990 0 0 {name=M4
l=3u
w=38u
ng=4
m=1
model=sg13_lv_pmos
spiceprefix=X
}
C {isource.sym} 1240 -830 0 0 {name=I2 value="30u"}
C {sg13g2_pr/sg13_lv_nmos.sym} 1220 -570 2 1 {name=M1
l=2u
w=82u
ng=9
m=1
model=sg13_lv_nmos
spiceprefix=X
}
C {sg13g2_pr/sg13_lv_nmos.sym} 1220 -470 2 1 {name=M5
l=2u
w=11u
ng=2
m=1
model=sg13_lv_nmos
spiceprefix=X
}
C {devices/gnd.sym} 1240 -370 0 0 {name=l2 lab=GND}
C {sg13g2_pr/sg13_lv_pmos.sym} 1560 -830 0 1 {name=M7
l=3u
w=18u
ng=2
m=1
model=sg13_lv_pmos
spiceprefix=X
}
C {sg13g2_pr/sg13_lv_nmos.sym} 1520 -570 2 1 {name=M8
l=1u
w=72u
ng=8
m=1
model=sg13_lv_nmos
spiceprefix=X
}
C {sg13g2_pr/sg13_lv_nmos.sym} 1520 -470 2 1 {name=M9
l=3u
w=14u
ng=2
m=1
model=sg13_lv_nmos
spiceprefix=X
}
C {sg13g2_pr/sg13_lv_nmos.sym} 1440 -470 2 0 {name=M10
l=3u
w=13u
ng=2
m=1
model=sg13_lv_nmos
spiceprefix=X
}
C {sg13g2_pr/sg13_lv_pmos.sym} 1740 -830 0 0 {name=M11
l=3u
w=18u
ng=2
m=1
model=sg13_lv_pmos
spiceprefix=X
}
C {sg13g2_pr/sg13_lv_nmos.sym} 1740 -630 2 1 {name=M13
l=3u
w=13u
ng=2
m=1
model=sg13_lv_nmos
spiceprefix=X
}
C {sg13g2_pr/sg13_lv_pmos.sym} 2200 -830 0 1 {name=M14
l=3u
w=18u
ng=2
m=1
model=sg13_lv_pmos
spiceprefix=X
}
C {sg13g2_pr/sg13_lv_nmos.sym} 2200 -630 2 0 {name=M16
l=3u
w=13u
ng=2
m=1
model=sg13_lv_nmos
spiceprefix=X
}
C {sg13g2_pr/sg13_lv_pmos.sym} 2350 -830 0 0 {name=M17
l=3u
w=18u
ng=2
m=1
model=sg13_lv_pmos
spiceprefix=X
}
C {sg13g2_pr/sg13_lv_pmos.sym} 1950 -440 0 1 {name=M20
l=19u
w=0.5u
ng=1
m=1
model=sg13_lv_pmos
spiceprefix=X
}
C {sg13g2_pr/sg13_lv_pmos.sym} 2010 -440 0 0 {name=M21
l=19u
w=0.5u
ng=1
m=1
model=sg13_lv_pmos
spiceprefix=X
}
C {sg13g2_pr/cap_cmim.sym} 1700 -470 0 0 {name=C2
model=cap_cmim
w=20.0e-6
l=20.0e-6
m=1
spiceprefix=X}
C {sg13g2_pr/cap_cmim.sym} 2160 -470 0 0 {name=C3
model=cap_cmim
w=20.0e-6
l=20.0e-6
m=1
spiceprefix=X}
C {sg13g2_pr/sg13_lv_nmos.sym} 2390 -410 2 0 {name=M22
l=3u
w=14u
ng=2
m=1
model=sg13_lv_nmos
spiceprefix=X
}
C {sg13g2_pr/sg13_lv_nmos.sym} 2390 -500 2 0 {name=M23
l=1u
w=72u
ng=8
m=1
model=sg13_lv_nmos
spiceprefix=X
}
C {sg13g2_pr/sg13_lv_pmos.sym} 1440 -990 0 1 {name=M24
l=3u
w=38u
ng=4
m=1
model=sg13_lv_pmos
spiceprefix=X
}
C {sg13g2_pr/sg13_lv_nmos.sym} 2520 -410 2 1 {name=M25
l=3u
w=13u
ng=2
m=1
model=sg13_lv_nmos
spiceprefix=X
}
C {sg13g2_pr/sg13_lv_nmos.sym} 2740 -410 2 1 {name=M26
l=1.5u
w=17u
ng=2
m=1
model=sg13_lv_nmos
spiceprefix=X
}
C {sg13g2_pr/sg13_lv_pmos.sym} 2740 -990 0 0 {name=M27
l=1.5u
w=36u
ng=4
m=1
model=sg13_lv_pmos
spiceprefix=X
}
C {sg13g2_pr/cap_cmim.sym} 2710 -720 3 0 {name=C4
model=cap_cmim
w=30.0e-6
l=30.0e-6
m=1
spiceprefix=X}
C {sg13g2_pr/cap_cmim.sym} 2860 -670 0 0 {name=C5
model=cap_cmim
w=7.0e-6
l=7.0e-6
m=1
spiceprefix=X}
C {devices/gnd.sym} 2860 -620 0 0 {name=l4 lab=GND}
C {lab_wire.sym} 2940 -720 0 0 {name=p2 sig_type=std_logic lab=v_out}
C {spice_probe.sym} 1180 -740 0 0 {name=p5 attrs=""}
C {spice_probe.sym} 1180 -670 0 0 {name=p6 attrs=""}
C {spice_probe.sym} 2820 -720 0 0 {name=p4 attrs=""}
C {sg13g2_pr/sg13_lv_pmos.sym} 2160 -730 0 0 {name=M2
l=3u
w=20u
ng=2
m=1
model=sg13_lv_pmos
spiceprefix=X
}
C {sg13g2_pr/sg13_lv_pmos.sym} 1780 -730 0 1 {name=M3
l=3u
w=20u
ng=2
m=1
model=sg13_lv_pmos
spiceprefix=X
}
C {devices/vsource.sym} 1000 -450 0 0 {name=Vin value="dc 0.8 ac 1"}
C {sg13g2_pr/sg13_lv_pmos.sym} 2020 -560 0 0 {name=M6
l=3u
w=20u
ng=2
m=1
model=sg13_lv_pmos
spiceprefix=X
}
C {sg13g2_pr/sg13_lv_pmos.sym} 1930 -560 0 1 {name=M12
l=3u
w=20u
ng=2
m=1
model=sg13_lv_pmos
spiceprefix=X
}
